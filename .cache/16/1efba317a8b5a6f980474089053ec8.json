{"id":"context/auth-context.js","dependencies":[{"name":"/srv/atlas/atlas-web/package.json","includedInParent":true,"mtime":1589460883313},{"name":"react","loc":{"line":1,"column":70},"parent":"/srv/atlas/atlas-web/src/context/auth-context.js","resolved":"/srv/atlas/atlas-web/node_modules/react/index.js"},{"name":"@auth0/auth0-spa-js","loc":{"line":2,"column":29},"parent":"/srv/atlas/atlas-web/src/context/auth-context.js","resolved":"/srv/atlas/atlas-web/node_modules/@auth0/auth0-spa-js/dist/auth0-spa-js.production.esm.js"},{"name":"prop-types","loc":{"line":3,"column":22},"parent":"/srv/atlas/atlas-web/src/context/auth-context.js","resolved":"/srv/atlas/atlas-web/node_modules/prop-types/index.js"},{"name":"axios","loc":{"line":4,"column":18},"parent":"/srv/atlas/atlas-web/src/context/auth-context.js","resolved":"/srv/atlas/atlas-web/node_modules/axios/index.js"}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useAuth = exports.AuthProvider = void 0;\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _auth0SpaJs = _interopRequireDefault(require(\"@auth0/auth0-spa-js\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _axios = _interopRequireDefault(require(\"axios\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nconst DEFAULT_REDIRECT_CALLBACK = () => window.history.replaceState({}, document.title, window.location.pathname);\n\nconst AuthContext = (0, _react.createContext)();\n\nconst AuthProvider = ({\n  children,\n  onRedirectCallback = DEFAULT_REDIRECT_CALLBACK,\n  ...initOptions\n}) => {\n  const [isAuthenticated, setIsAuthenticated] = (0, _react.useState)();\n  const [user, setUser] = (0, _react.useState)();\n  const [auth0Client, setAuth] = (0, _react.useState)();\n  const [loading, setLoading] = (0, _react.useState)(true);\n  const [popupOpen, setPopupOpen] = (0, _react.useState)(false);\n  (0, _react.useEffect)(() => {\n    const fetchUserData = async id => {\n      const opts = {\n        url: `${\"http://localhost:8787/api\"}/userdata/${id}`,\n        method: 'GET'\n      };\n      const res = await (0, _axios.default)(opts).catch(err => console.log(err));\n      return res.data.data;\n    };\n\n    const initAuth = async () => {\n      const auth0FromHook = await (0, _auth0SpaJs.default)(initOptions);\n      setAuth(auth0FromHook);\n\n      if (window.location.search.includes('code=') && window.location.search.includes('state=')) {\n        const {\n          appState\n        } = await auth0FromHook.handleRedirectCallback();\n        onRedirectCallback(appState);\n      }\n\n      const isAuthenticated = await auth0FromHook.isAuthenticated();\n      setIsAuthenticated(isAuthenticated);\n\n      if (isAuthenticated) {\n        const token = await auth0FromHook.getTokenSilently();\n        const user = await auth0FromHook.getUser();\n        _axios.default.defaults.headers.common.authorization = `Bearer ${token}`;\n        const userData = await fetchUserData(user.sub);\n        setUser(userData);\n      }\n\n      setLoading(false);\n    };\n\n    initAuth(); // eslint-disable-next-line\n  }, []);\n  return (\n    /*#__PURE__*/\n    _react.default.createElement(AuthContext.Provider, {\n      value: {\n        isAuthenticated,\n        user,\n        loading,\n        loginWithRedirect: (...p) => auth0Client.loginWithRedirect(...p),\n        logout: (...p) => auth0Client.logout(...p)\n      }\n    }, children)\n  );\n};\n\nexports.AuthProvider = AuthProvider;\nAuthProvider.propTypes = {\n  children: _propTypes.default.object,\n  onRedirectCallback: _propTypes.default.func\n};\n\nconst useAuth = () => (0, _react.useContext)(AuthContext);\n\nexports.useAuth = useAuth;"},"sourceMaps":null,"error":null,"hash":"747b80fabcf86434890233256fb7ccdd","cacheData":{"env":{"API_URL":"http://localhost:8787/api"}}}